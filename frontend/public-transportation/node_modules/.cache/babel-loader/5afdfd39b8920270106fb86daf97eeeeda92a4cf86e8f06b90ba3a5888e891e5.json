{"ast":null,"code":"/**\n * Public Transportation API Service\n * Handles queries to Israel's public transportation SIRI-SM API\n */\n\nimport axios from 'axios';\n\n// Update the URL to use HTTP instead of HTTPS\nconst PROXY_URL = 'http://localhost/api/transport.php';\n\n/**\n * Get real-time arrivals for a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @returns {Promise<Object>} - The arrivals data\n */\nexport async function getStationArrivals(stationCode) {\n  try {\n    var _response$data, _response$data$Siri;\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}`);\n    // Add fallback if data is not in expected format\n    if (!((_response$data = response.data) !== null && _response$data !== void 0 && (_response$data$Siri = _response$data.Siri) !== null && _response$data$Siri !== void 0 && _response$data$Siri.ServiceDelivery)) {\n      console.warn('Unexpected response format:', response.data);\n      throw new Error('Unexpected response format from API');\n    }\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Get arrivals for a specific line at a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @param {string|number} lineNumber - The line number (e.g., 60)\n * @returns {Promise<Object>} - The filtered arrivals data\n */\nexport async function getLineArrivalsAtStation(stationCode, lineNumber) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}&line=${lineNumber}`);\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching line arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Process the raw data from the SIRI-SM API\n * @param {Object} data - Raw API response\n * @returns {Array} - Processed arrival data\n */\nfunction processArrivalsData(data) {\n  try {\n    var _data$Siri, _data$Siri$ServiceDel, _data$Siri$ServiceDel2, _data$Siri$ServiceDel3;\n    // Extract the monitor visits from the response\n    const monitoredStopVisits = (data === null || data === void 0 ? void 0 : (_data$Siri = data.Siri) === null || _data$Siri === void 0 ? void 0 : (_data$Siri$ServiceDel = _data$Siri.ServiceDelivery) === null || _data$Siri$ServiceDel === void 0 ? void 0 : (_data$Siri$ServiceDel2 = _data$Siri$ServiceDel.StopMonitoringDelivery) === null || _data$Siri$ServiceDel2 === void 0 ? void 0 : (_data$Siri$ServiceDel3 = _data$Siri$ServiceDel2[0]) === null || _data$Siri$ServiceDel3 === void 0 ? void 0 : _data$Siri$ServiceDel3.MonitoredStopVisit) || [];\n\n    // Map the data to a more usable format\n    return monitoredStopVisits.map(visit => {\n      var _journey$FramedVehicl, _journey$OnwardCalls, _journey$OnwardCalls$;\n      const journey = visit.MonitoredVehicleJourney;\n      const call = journey.MonitoredCall;\n      return {\n        lineNumber: journey.PublishedLineName,\n        operatorRef: journey.OperatorRef,\n        destinationName: journey.DestinationName || journey.DestinationRef,\n        vehicleRef: journey.VehicleRef,\n        expectedArrival: (call === null || call === void 0 ? void 0 : call.ExpectedArrivalTime) || null,\n        aimedArrival: (call === null || call === void 0 ? void 0 : call.AimedArrivalTime) || null,\n        arrivalStatus: (call === null || call === void 0 ? void 0 : call.ArrivalStatus) || null,\n        distanceFromStop: (call === null || call === void 0 ? void 0 : call.DistanceFromStop) || null,\n        recordedAt: visit.RecordedAtTime,\n        stopPointRef: (call === null || call === void 0 ? void 0 : call.StopPointRef) || null,\n        tripId: ((_journey$FramedVehicl = journey.FramedVehicleJourneyRef) === null || _journey$FramedVehicl === void 0 ? void 0 : _journey$FramedVehicl.DatedVehicleJourneyRef) || null,\n        onwardCalls: ((_journey$OnwardCalls = journey.OnwardCalls) === null || _journey$OnwardCalls === void 0 ? void 0 : (_journey$OnwardCalls$ = _journey$OnwardCalls.OnwardCall) === null || _journey$OnwardCalls$ === void 0 ? void 0 : _journey$OnwardCalls$.map(call => ({\n          stopCode: call.StopPointRef,\n          order: call.Order,\n          expectedArrival: call.ExpectedArrivalTime,\n          status: call.ArrivalStatus\n        }))) || []\n      };\n    });\n  } catch (error) {\n    console.error('Error processing arrivals data:', error);\n    return [];\n  }\n}","map":{"version":3,"names":["axios","PROXY_URL","getStationArrivals","stationCode","_response$data","_response$data$Siri","response","get","data","Siri","ServiceDelivery","console","warn","Error","processArrivalsData","error","getLineArrivalsAtStation","lineNumber","_data$Siri","_data$Siri$ServiceDel","_data$Siri$ServiceDel2","_data$Siri$ServiceDel3","monitoredStopVisits","StopMonitoringDelivery","MonitoredStopVisit","map","visit","_journey$FramedVehicl","_journey$OnwardCalls","_journey$OnwardCalls$","journey","MonitoredVehicleJourney","call","MonitoredCall","PublishedLineName","operatorRef","OperatorRef","destinationName","DestinationName","DestinationRef","vehicleRef","VehicleRef","expectedArrival","ExpectedArrivalTime","aimedArrival","AimedArrivalTime","arrivalStatus","ArrivalStatus","distanceFromStop","DistanceFromStop","recordedAt","RecordedAtTime","stopPointRef","StopPointRef","tripId","FramedVehicleJourneyRef","DatedVehicleJourneyRef","onwardCalls","OnwardCalls","OnwardCall","stopCode","order","Order","status"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/api-service.js"],"sourcesContent":["/**\n * Public Transportation API Service\n * Handles queries to Israel's public transportation SIRI-SM API\n */\n\nimport axios from 'axios';\n\n// Update the URL to use HTTP instead of HTTPS\nconst PROXY_URL = 'http://localhost/api/transport.php';\n\n/**\n * Get real-time arrivals for a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @returns {Promise<Object>} - The arrivals data\n */\nexport async function getStationArrivals(stationCode) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}`);\n    // Add fallback if data is not in expected format\n    if (!response.data?.Siri?.ServiceDelivery) {\n      console.warn('Unexpected response format:', response.data);\n      throw new Error('Unexpected response format from API');\n    }\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Get arrivals for a specific line at a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @param {string|number} lineNumber - The line number (e.g., 60)\n * @returns {Promise<Object>} - The filtered arrivals data\n */\nexport async function getLineArrivalsAtStation(stationCode, lineNumber) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}&line=${lineNumber}`);\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching line arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Process the raw data from the SIRI-SM API\n * @param {Object} data - Raw API response\n * @returns {Array} - Processed arrival data\n */\nfunction processArrivalsData(data) {\n  try {\n    // Extract the monitor visits from the response\n    const monitoredStopVisits = \n      data?.Siri?.ServiceDelivery?.StopMonitoringDelivery?.[0]?.MonitoredStopVisit || [];\n    \n    // Map the data to a more usable format\n    return monitoredStopVisits.map(visit => {\n      const journey = visit.MonitoredVehicleJourney;\n      const call = journey.MonitoredCall;\n      \n      return {\n        lineNumber: journey.PublishedLineName,\n        operatorRef: journey.OperatorRef,\n        destinationName: journey.DestinationName || journey.DestinationRef,\n        vehicleRef: journey.VehicleRef,\n        expectedArrival: call?.ExpectedArrivalTime || null,\n        aimedArrival: call?.AimedArrivalTime || null,\n        arrivalStatus: call?.ArrivalStatus || null,\n        distanceFromStop: call?.DistanceFromStop || null,\n        recordedAt: visit.RecordedAtTime,\n        stopPointRef: call?.StopPointRef || null,\n        tripId: journey.FramedVehicleJourneyRef?.DatedVehicleJourneyRef || null,\n        onwardCalls: journey.OnwardCalls?.OnwardCall?.map(call => ({\n          stopCode: call.StopPointRef,\n          order: call.Order,\n          expectedArrival: call.ExpectedArrivalTime,\n          status: call.ArrivalStatus\n        })) || []\n      };\n    });\n  } catch (error) {\n    console.error('Error processing arrivals data:', error);\n    return [];\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}