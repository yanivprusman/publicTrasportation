{"ast":null,"code":"import axios from 'axios';\n\n/**\n * Get real-time arrivals for a station\n * @param {string} stationCode - The station code\n * @param {string} detailLevel - The level of detail ('normal' or 'calls')\n * @returns {Promise<Object>} - The arrivals data\n */\nexport const fetchStationArrivals = async (stationCode, detailLevel = 'calls') => {\n  try {\n    const response = await axios.get(`/transport.php?station=${stationCode}&detail=${detailLevel}`);\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw new Error(`Failed to fetch arrivals: ${error.message}`);\n  }\n};\n\n/**\n * Extract vehicle markers from SIRI data\n * @param {Object} siriData - The SIRI data from the API\n * @returns {Array} - Array of vehicle marker objects\n */\nexport const extractVehicleMarkers = siriData => {\n  var _siriData$Siri, _siriData$Siri$Servic, _siriData$Siri$Servic2, _siriData$Siri$Servic3;\n  if (!(siriData !== null && siriData !== void 0 && (_siriData$Siri = siriData.Siri) !== null && _siriData$Siri !== void 0 && (_siriData$Siri$Servic = _siriData$Siri.ServiceDelivery) !== null && _siriData$Siri$Servic !== void 0 && (_siriData$Siri$Servic2 = _siriData$Siri$Servic.StopMonitoringDelivery) !== null && _siriData$Siri$Servic2 !== void 0 && (_siriData$Siri$Servic3 = _siriData$Siri$Servic2[0]) !== null && _siriData$Siri$Servic3 !== void 0 && _siriData$Siri$Servic3.MonitoredStopVisit)) {\n    return [];\n  }\n  const monitoredStopVisits = siriData.Siri.ServiceDelivery.StopMonitoringDelivery[0].MonitoredStopVisit;\n  return monitoredStopVisits.map(visit => {\n    const journey = visit.MonitoredVehicleJourney || {};\n    const vehicleLocation = journey.VehicleLocation || {};\n    if (vehicleLocation.Latitude && vehicleLocation.Longitude) {\n      var _journey$MonitoredCal, _journey$MonitoredCal2;\n      return {\n        position: [vehicleLocation.Latitude, vehicleLocation.Longitude],\n        vehicleRef: journey.VehicleRef,\n        lineNumber: journey.PublishedLineName,\n        expectedArrival: (_journey$MonitoredCal = journey.MonitoredCall) === null || _journey$MonitoredCal === void 0 ? void 0 : _journey$MonitoredCal.ExpectedArrivalTime,\n        distanceFromStop: (_journey$MonitoredCal2 = journey.MonitoredCall) === null || _journey$MonitoredCal2 === void 0 ? void 0 : _journey$MonitoredCal2.DistanceFromStop\n      };\n    }\n    return null;\n  }).filter(Boolean);\n};\n\n/**\n * Fetch the route shape for a given line number\n * @param {string} lineNumber - The line number\n * @returns {Promise<Object>} - The route shape data\n */\nexport const fetchLineShape = async lineNumber => {\n  try {\n    console.log(`Fetching line shape for line ${lineNumber}`);\n\n    // Try API path first\n    try {\n      const response = await axios.get(`/api/gtfs-api.php?action=getLineShape&line=${lineNumber}`);\n      console.log('Line shape response:', response.data);\n\n      // If we got an error, try the debug endpoint to diagnose the issue\n      if (response.data.error) {\n        console.warn('Error response:', response.data);\n        try {\n          const debugResponse = await axios.get('/api/debug-gtfs-routes.php');\n          console.info('GTFS routes debug info:', debugResponse.data);\n        } catch (debugErr) {\n          console.warn('Failed to get debug info:', debugErr);\n        }\n      }\n      return response.data;\n    } catch (error) {\n      console.warn(`Error with primary API path: ${error.message}`);\n\n      // Try fallback path if the first one fails\n      const fallbackResponse = await axios.get(`/gtfs-api.php?action=getLineShape&line=${lineNumber}`);\n      console.log('Line shape fallback response:', fallbackResponse.data);\n      return fallbackResponse.data;\n    }\n  } catch (error) {\n    console.error('Error fetching line shape:', error);\n    throw new Error(`Failed to fetch line shape: ${error.message}`);\n  }\n};","map":{"version":3,"names":["axios","fetchStationArrivals","stationCode","detailLevel","response","get","data","error","console","Error","message","extractVehicleMarkers","siriData","_siriData$Siri","_siriData$Siri$Servic","_siriData$Siri$Servic2","_siriData$Siri$Servic3","Siri","ServiceDelivery","StopMonitoringDelivery","MonitoredStopVisit","monitoredStopVisits","map","visit","journey","MonitoredVehicleJourney","vehicleLocation","VehicleLocation","Latitude","Longitude","_journey$MonitoredCal","_journey$MonitoredCal2","position","vehicleRef","VehicleRef","lineNumber","PublishedLineName","expectedArrival","MonitoredCall","ExpectedArrivalTime","distanceFromStop","DistanceFromStop","filter","Boolean","fetchLineShape","log","warn","debugResponse","info","debugErr","fallbackResponse"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/services/transport-api.js"],"sourcesContent":["import axios from 'axios';\n\n/**\n * Get real-time arrivals for a station\n * @param {string} stationCode - The station code\n * @param {string} detailLevel - The level of detail ('normal' or 'calls')\n * @returns {Promise<Object>} - The arrivals data\n */\nexport const fetchStationArrivals = async (stationCode, detailLevel = 'calls') => {\n  try {\n    const response = await axios.get(`/transport.php?station=${stationCode}&detail=${detailLevel}`);\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw new Error(`Failed to fetch arrivals: ${error.message}`);\n  }\n};\n\n/**\n * Extract vehicle markers from SIRI data\n * @param {Object} siriData - The SIRI data from the API\n * @returns {Array} - Array of vehicle marker objects\n */\nexport const extractVehicleMarkers = (siriData) => {\n  if (!siriData?.Siri?.ServiceDelivery?.StopMonitoringDelivery?.[0]?.MonitoredStopVisit) {\n    return [];\n  }\n\n  const monitoredStopVisits = siriData.Siri.ServiceDelivery.StopMonitoringDelivery[0].MonitoredStopVisit;\n  \n  return monitoredStopVisits.map(visit => {\n    const journey = visit.MonitoredVehicleJourney || {};\n    const vehicleLocation = journey.VehicleLocation || {};\n    \n    if (vehicleLocation.Latitude && vehicleLocation.Longitude) {\n      return {\n        position: [vehicleLocation.Latitude, vehicleLocation.Longitude],\n        vehicleRef: journey.VehicleRef,\n        lineNumber: journey.PublishedLineName,\n        expectedArrival: journey.MonitoredCall?.ExpectedArrivalTime,\n        distanceFromStop: journey.MonitoredCall?.DistanceFromStop\n      };\n    }\n    return null;\n  }).filter(Boolean);\n};\n\n/**\n * Fetch the route shape for a given line number\n * @param {string} lineNumber - The line number\n * @returns {Promise<Object>} - The route shape data\n */\nexport const fetchLineShape = async (lineNumber) => {\n  try {\n    console.log(`Fetching line shape for line ${lineNumber}`);\n    \n    // Try API path first\n    try {\n      const response = await axios.get(`/api/gtfs-api.php?action=getLineShape&line=${lineNumber}`);\n      console.log('Line shape response:', response.data);\n      \n      // If we got an error, try the debug endpoint to diagnose the issue\n      if (response.data.error) {\n        console.warn('Error response:', response.data);\n        try {\n          const debugResponse = await axios.get('/api/debug-gtfs-routes.php');\n          console.info('GTFS routes debug info:', debugResponse.data);\n        } catch (debugErr) {\n          console.warn('Failed to get debug info:', debugErr);\n        }\n      }\n      \n      return response.data;\n    } catch (error) {\n      console.warn(`Error with primary API path: ${error.message}`);\n      \n      // Try fallback path if the first one fails\n      const fallbackResponse = await axios.get(`/gtfs-api.php?action=getLineShape&line=${lineNumber}`);\n      console.log('Line shape fallback response:', fallbackResponse.data);\n      return fallbackResponse.data;\n    }\n  } catch (error) {\n    console.error('Error fetching line shape:', error);\n    throw new Error(`Failed to fetch line shape: ${error.message}`);\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}