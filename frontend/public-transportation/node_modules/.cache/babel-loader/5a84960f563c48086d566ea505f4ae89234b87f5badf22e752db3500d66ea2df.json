{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport axios from 'axios';\nimport { fetchAddress, findRoute } from '../components/map/MapUtilities';\n\n/**\n * Hook that provides map-related handler functions\n */\nconst useMapHandlers = (position, setPosition, destination, onDestinationSet, setMapCenter, mapCenter) => {\n  _s();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchError, setSearchError] = useState(null);\n  const [positionAddress, setPositionAddress] = useState('');\n  const [destinationAddress, setDestinationAddress] = useState('');\n\n  // Handle search input and query nominatim API\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) return;\n    try {\n      setSearchError(null);\n      const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(searchQuery)}&format=json`);\n      if (response.data.length > 0) {\n        const {\n          lat,\n          lon\n        } = response.data[0];\n        setMapCenter([parseFloat(lat), parseFloat(lon)]);\n      } else {\n        setSearchError('Location not found.');\n      }\n    } catch (error) {\n      setSearchError('Error fetching location. Please try again.');\n    }\n  };\n\n  // Set the starting point to the current map center\n  const handleSetStartPoint = () => {\n    if (mapCenter && Array.isArray(mapCenter) && mapCenter.length === 2) {\n      // Update position state with setPosition instead of modifying array directly\n      setPosition([mapCenter[0], mapCenter[1]]);\n      fetchAddress(mapCenter[0], mapCenter[1], setPositionAddress);\n      console.log(\"Starting position updated to:\", mapCenter);\n    }\n  };\n\n  // Set the destination to the current map center\n  const handleSetDestinationPoint = () => {\n    if (mapCenter && Array.isArray(mapCenter) && mapCenter.length === 2) {\n      console.log(\"Setting destination to map center:\", mapCenter);\n      onDestinationSet(mapCenter);\n      fetchAddress(mapCenter[0], mapCenter[1], setDestinationAddress);\n    } else {\n      console.error(\"Invalid map center for destination:\", mapCenter);\n    }\n  };\n\n  // Handle keyboard events for search\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  // Find a route between position and destination\n  const handleFindRoute = async () => {\n    console.log(\"Find route called with: position=\", position, \"destination=\", destination);\n    if (!destination || !destination[0] || !destination[1]) {\n      console.error(\"Missing or invalid destination:\", destination);\n      setSearchError('Please set a destination first.');\n      return null;\n    }\n    try {\n      setSearchError(null);\n      // Explicitly use the current position, not map center\n      const routeData = await findRoute(position, destination);\n      if (routeData) {\n        console.log(\"Route data received:\", routeData.length, \"points\");\n        return routeData;\n      } else {\n        setSearchError('No route found. Please try again with different locations.');\n        return null;\n      }\n    } catch (error) {\n      console.error(\"Error in findRoute:\", error);\n      setSearchError('Error fetching route. Please try again.');\n      return null;\n    }\n  };\n  return {\n    searchQuery,\n    setSearchQuery,\n    searchError,\n    setSearchError,\n    // Make sure we expose setSearchError in the return value\n    positionAddress,\n    destinationAddress,\n    setPositionAddress,\n    setDestinationAddress,\n    handleSearch,\n    handleSetStartPoint,\n    handleSetDestinationPoint,\n    handleKeyPress,\n    handleFindRoute\n  };\n};\n_s(useMapHandlers, \"SCu2p6AoFj+L6JkmJKJRMr561NM=\");\nexport default useMapHandlers;","map":{"version":3,"names":["useState","axios","fetchAddress","findRoute","useMapHandlers","position","setPosition","destination","onDestinationSet","setMapCenter","mapCenter","_s","searchQuery","setSearchQuery","searchError","setSearchError","positionAddress","setPositionAddress","destinationAddress","setDestinationAddress","handleSearch","trim","response","get","encodeURIComponent","data","length","lat","lon","parseFloat","error","handleSetStartPoint","Array","isArray","console","log","handleSetDestinationPoint","handleKeyPress","e","key","handleFindRoute","routeData"],"sources":["/home/yaniv/101_coding/publicTransportation/react-public-transportation/src/hooks/useMapHandlers.js"],"sourcesContent":["import { useState } from 'react';\nimport axios from 'axios';\nimport { fetchAddress, findRoute } from '../components/map/MapUtilities';\n\n/**\n * Hook that provides map-related handler functions\n */\nconst useMapHandlers = (position, setPosition, destination, onDestinationSet, setMapCenter, mapCenter) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchError, setSearchError] = useState(null);\n  const [positionAddress, setPositionAddress] = useState('');\n  const [destinationAddress, setDestinationAddress] = useState('');\n  \n  // Handle search input and query nominatim API\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) return;\n\n    try {\n      setSearchError(null);\n      const response = await axios.get(\n        `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(searchQuery)}&format=json`\n      );\n      if (response.data.length > 0) {\n        const { lat, lon } = response.data[0];\n        setMapCenter([parseFloat(lat), parseFloat(lon)]);\n      } else {\n        setSearchError('Location not found.');\n      }\n    } catch (error) {\n      setSearchError('Error fetching location. Please try again.');\n    }\n  };\n\n  // Set the starting point to the current map center\n  const handleSetStartPoint = () => {\n    if (mapCenter && Array.isArray(mapCenter) && mapCenter.length === 2) {\n      // Update position state with setPosition instead of modifying array directly\n      setPosition([mapCenter[0], mapCenter[1]]);\n      fetchAddress(mapCenter[0], mapCenter[1], setPositionAddress);\n      console.log(\"Starting position updated to:\", mapCenter);\n    }\n  };\n\n  // Set the destination to the current map center\n  const handleSetDestinationPoint = () => {\n    if (mapCenter && Array.isArray(mapCenter) && mapCenter.length === 2) {\n      console.log(\"Setting destination to map center:\", mapCenter);\n      onDestinationSet(mapCenter);\n      fetchAddress(mapCenter[0], mapCenter[1], setDestinationAddress);\n    } else {\n      console.error(\"Invalid map center for destination:\", mapCenter);\n    }\n  };\n\n  // Handle keyboard events for search\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  // Find a route between position and destination\n  const handleFindRoute = async () => {\n    console.log(\"Find route called with: position=\", position, \"destination=\", destination);\n    \n    if (!destination || !destination[0] || !destination[1]) {\n      console.error(\"Missing or invalid destination:\", destination);\n      setSearchError('Please set a destination first.');\n      return null;\n    }\n\n    try {\n      setSearchError(null);\n      // Explicitly use the current position, not map center\n      const routeData = await findRoute(position, destination);\n      \n      if (routeData) {\n        console.log(\"Route data received:\", routeData.length, \"points\");\n        return routeData;\n      } else {\n        setSearchError('No route found. Please try again with different locations.');\n        return null;\n      }\n    } catch (error) {\n      console.error(\"Error in findRoute:\", error);\n      setSearchError('Error fetching route. Please try again.');\n      return null;\n    }\n  };\n\n  return {\n    searchQuery,\n    setSearchQuery,\n    searchError,\n    setSearchError,  // Make sure we expose setSearchError in the return value\n    positionAddress,\n    destinationAddress,\n    setPositionAddress,\n    setDestinationAddress,\n    handleSearch,\n    handleSetStartPoint,\n    handleSetDestinationPoint,\n    handleKeyPress,\n    handleFindRoute\n  };\n};\n\nexport default useMapHandlers;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}