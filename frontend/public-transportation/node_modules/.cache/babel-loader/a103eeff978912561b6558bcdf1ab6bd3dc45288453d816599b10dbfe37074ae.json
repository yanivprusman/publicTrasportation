{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport axios from 'axios';\nimport { fetchAddress, findRoute } from '../components/map/MapUtilities';\n\n/**\n * Hook that provides map-related handler functions\n */\nexport const useMapHandlers = (position, destination, onDestinationSet, setMapCenter) => {\n  _s();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchError, setSearchError] = useState(null);\n  const [positionAddress, setPositionAddress] = useState('');\n  const [destinationAddress, setDestinationAddress] = useState('');\n\n  // Handle search input and query nominatim API\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) return;\n    try {\n      setSearchError(null);\n      const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(searchQuery)}&format=json`);\n      if (response.data.length > 0) {\n        const {\n          lat,\n          lon\n        } = response.data[0];\n        setMapCenter([parseFloat(lat), parseFloat(lon)]);\n      } else {\n        setSearchError('Location not found.');\n      }\n    } catch (error) {\n      setSearchError('Error fetching location. Please try again.');\n    }\n  };\n\n  // Set the starting point to the current map center\n  const handleSetStartPoint = () => {\n    fetchAddress(position[0], position[1], setPositionAddress);\n  };\n\n  // Set the destination to the current map center\n  const handleSetDestinationPoint = () => {\n    const newDestination = position;\n    onDestinationSet(newDestination);\n    fetchAddress(newDestination[0], newDestination[1], setDestinationAddress);\n  };\n\n  // Handle keyboard events for search\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  // Find a route between position and destination\n  const handleFindRoute = async () => {\n    if (!destination) {\n      setSearchError('Please set a destination first.');\n      return;\n    }\n    const MAX_RETRIES = 3;\n    let attempts = 0;\n    while (attempts < MAX_RETRIES) {\n      try {\n        setSearchError(null);\n        const routeData = await findRoute(position, destination);\n        if (routeData) {\n          return routeData;\n        } else {\n          setSearchError('No route found. Please try again with different locations.');\n          return null;\n        }\n      } catch (error) {\n        attempts++;\n        if (attempts >= MAX_RETRIES) {\n          setSearchError('Error fetching route. Please try again.');\n        }\n      }\n    }\n    return null;\n  };\n  return {\n    searchQuery,\n    setSearchQuery,\n    searchError,\n    positionAddress,\n    destinationAddress,\n    setPositionAddress,\n    setDestinationAddress,\n    handleSearch,\n    handleSetStartPoint,\n    handleSetDestinationPoint,\n    handleKeyPress,\n    handleFindRoute\n  };\n};\n_s(useMapHandlers, \"SCu2p6AoFj+L6JkmJKJRMr561NM=\");\nexport default useMapHandlers;","map":{"version":3,"names":["useState","axios","fetchAddress","findRoute","useMapHandlers","position","destination","onDestinationSet","setMapCenter","_s","searchQuery","setSearchQuery","searchError","setSearchError","positionAddress","setPositionAddress","destinationAddress","setDestinationAddress","handleSearch","trim","response","get","encodeURIComponent","data","length","lat","lon","parseFloat","error","handleSetStartPoint","handleSetDestinationPoint","newDestination","handleKeyPress","e","key","handleFindRoute","MAX_RETRIES","attempts","routeData"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/hooks/useMapHandlers.js"],"sourcesContent":["import { useState } from 'react';\nimport axios from 'axios';\nimport { fetchAddress, findRoute } from '../components/map/MapUtilities';\n\n/**\n * Hook that provides map-related handler functions\n */\nexport const useMapHandlers = (position, destination, onDestinationSet, setMapCenter) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchError, setSearchError] = useState(null);\n  const [positionAddress, setPositionAddress] = useState('');\n  const [destinationAddress, setDestinationAddress] = useState('');\n  \n  // Handle search input and query nominatim API\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) return;\n\n    try {\n      setSearchError(null);\n      const response = await axios.get(\n        `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(searchQuery)}&format=json`\n      );\n      if (response.data.length > 0) {\n        const { lat, lon } = response.data[0];\n        setMapCenter([parseFloat(lat), parseFloat(lon)]);\n      } else {\n        setSearchError('Location not found.');\n      }\n    } catch (error) {\n      setSearchError('Error fetching location. Please try again.');\n    }\n  };\n\n  // Set the starting point to the current map center\n  const handleSetStartPoint = () => {\n    fetchAddress(position[0], position[1], setPositionAddress);\n  };\n\n  // Set the destination to the current map center\n  const handleSetDestinationPoint = () => {\n    const newDestination = position;\n    onDestinationSet(newDestination);\n    fetchAddress(newDestination[0], newDestination[1], setDestinationAddress);\n  };\n\n  // Handle keyboard events for search\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  // Find a route between position and destination\n  const handleFindRoute = async () => {\n    if (!destination) {\n      setSearchError('Please set a destination first.');\n      return;\n    }\n\n    const MAX_RETRIES = 3;\n    let attempts = 0;\n\n    while (attempts < MAX_RETRIES) {\n      try {\n        setSearchError(null);\n        const routeData = await findRoute(position, destination);\n        \n        if (routeData) {\n          return routeData;\n        } else {\n          setSearchError('No route found. Please try again with different locations.');\n          return null;\n        }\n      } catch (error) {\n        attempts++;\n        if (attempts >= MAX_RETRIES) {\n          setSearchError('Error fetching route. Please try again.');\n        }\n      }\n    }\n    return null;\n  };\n\n  return {\n    searchQuery,\n    setSearchQuery,\n    searchError,\n    positionAddress,\n    destinationAddress,\n    setPositionAddress,\n    setDestinationAddress,\n    handleSearch,\n    handleSetStartPoint,\n    handleSetDestinationPoint,\n    handleKeyPress,\n    handleFindRoute\n  };\n};\n\nexport default useMapHandlers;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}