server {
    listen 80;
    server_name localhost;
    root /home/yaniv/1Iz3UBgvtNDVfVo;
    index index.php index.html;

    # API requests go to Laravel
    location ~ ^/(api|transport\.php|simple-shape-api\.php|gtfs-shape-api\.php|stops-data\.php) {
        # Set the correct SCRIPT_FILENAME for the Laravel public directory
        root /home/yaniv/101_coding/publicTransportation/laravel/public;
        
        # Laravel index.php handles all requests
        try_files $uri $uri/ /index.php?$query_string;
        
        # Process PHP files with FastCGI
        location ~ \.php$ {
            include snippets/fastcgi-php.conf;
            fastcgi_param SCRIPT_FILENAME $document_root/index.php;
            fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
            include fastcgi_params;
        }
    }

    # Static assets in Laravel
    location ~ ^/laravel/(css|js|storage) {
        root /home/yaniv/101_coding/publicTransportation;
        try_files $uri $uri/ =404;
    }

    # React app serves the rest
    location / {
        try_files $uri $uri/ /index.html;
    }

    # PHP files outside of Laravel
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        include fastcgi_params;
    }
}
