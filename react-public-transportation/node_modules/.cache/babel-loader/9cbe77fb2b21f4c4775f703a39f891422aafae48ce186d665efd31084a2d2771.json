{"ast":null,"code":"import * as siriService from '../api-service';\nimport * as gtfsService from './gtfs-service';\n\n/**\n * Get combined static and real-time data for a station\n * @param {string} stationCode - The station code\n * @returns {Promise<Object>} Combined data\n */\nexport async function getStationData(stationCode) {\n  try {\n    // Get real-time arrivals\n    const realTimeArrivals = await siriService.getStationArrivals(stationCode);\n\n    // Get scheduled departures\n    const scheduledDepartures = await gtfsService.getScheduledDepartures(stationCode);\n\n    // Merge the data\n    const combinedData = mergeRealTimeAndSchedule(realTimeArrivals, scheduledDepartures);\n    return {\n      stationCode,\n      realTimeArrivals,\n      scheduledDepartures,\n      combinedData\n    };\n  } catch (error) {\n    console.error(`Error getting combined data for station ${stationCode}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Get stop details including geographical location\n * @param {string} stopId - The stop ID\n * @returns {Promise<Object>} Stop details\n */\nexport async function getStopDetails(stopId) {\n  try {\n    const stops = await gtfsService.getStops();\n    return stops.find(stop => stop.stopId === stopId) || null;\n  } catch (error) {\n    console.error(`Error getting details for stop ${stopId}:`, error);\n    return null;\n  }\n}\n\n/**\n * Merge real-time arrivals with scheduled departures\n * @param {Array} realTimeArrivals - Real-time arrival data\n * @param {Array} scheduledDepartures - Scheduled departure data\n * @returns {Array} Combined data with real-time updates where available\n */\nfunction mergeRealTimeAndSchedule(realTimeArrivals, scheduledDepartures) {\n  // Create a map of trips from real-time data\n  const realTimeMap = new Map();\n  realTimeArrivals.forEach(arrival => {\n    // Use tripId as the key\n    realTimeMap.set(arrival.tripId, arrival);\n  });\n\n  // Enhance scheduled departures with real-time data\n  return scheduledDepartures.map(departure => {\n    const realTimeData = realTimeMap.get(departure.tripId);\n    if (realTimeData) {\n      // Add real-time information\n      return {\n        ...departure,\n        realTime: true,\n        expectedArrival: realTimeData.expectedArrival,\n        delay: calculateDelay(departure.scheduledArrival, realTimeData.expectedArrival),\n        vehicleLocation: realTimeData.vehicleLocation || null,\n        distanceFromStop: realTimeData.distanceFromStop || null\n      };\n    } else {\n      // No real-time data available, use scheduled time\n      return {\n        ...departure,\n        realTime: false\n      };\n    }\n  });\n}\n\n/**\n * Calculate delay in minutes between scheduled and expected times\n * @param {string} scheduledTime - ISO datetime string\n * @param {string} expectedTime - ISO datetime string\n * @returns {number} Delay in minutes (positive = late, negative = early)\n */\nfunction calculateDelay(scheduledTime, expectedTime) {\n  if (!scheduledTime || !expectedTime) return 0;\n  const scheduled = new Date(scheduledTime);\n  const expected = new Date(expectedTime);\n\n  // Calculate difference in minutes\n  return Math.round((expected - scheduled) / (60 * 1000));\n}","map":{"version":3,"names":["siriService","gtfsService","getStationData","stationCode","realTimeArrivals","getStationArrivals","scheduledDepartures","getScheduledDepartures","combinedData","mergeRealTimeAndSchedule","error","console","getStopDetails","stopId","stops","getStops","find","stop","realTimeMap","Map","forEach","arrival","set","tripId","map","departure","realTimeData","get","realTime","expectedArrival","delay","calculateDelay","scheduledArrival","vehicleLocation","distanceFromStop","scheduledTime","expectedTime","scheduled","Date","expected","Math","round"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/services/transportation-service.js"],"sourcesContent":["import * as siriService from '../api-service';\nimport * as gtfsService from './gtfs-service';\n\n/**\n * Get combined static and real-time data for a station\n * @param {string} stationCode - The station code\n * @returns {Promise<Object>} Combined data\n */\nexport async function getStationData(stationCode) {\n  try {\n    // Get real-time arrivals\n    const realTimeArrivals = await siriService.getStationArrivals(stationCode);\n    \n    // Get scheduled departures\n    const scheduledDepartures = await gtfsService.getScheduledDepartures(stationCode);\n    \n    // Merge the data\n    const combinedData = mergeRealTimeAndSchedule(realTimeArrivals, scheduledDepartures);\n    \n    return {\n      stationCode,\n      realTimeArrivals,\n      scheduledDepartures,\n      combinedData\n    };\n  } catch (error) {\n    console.error(`Error getting combined data for station ${stationCode}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Get stop details including geographical location\n * @param {string} stopId - The stop ID\n * @returns {Promise<Object>} Stop details\n */\nexport async function getStopDetails(stopId) {\n  try {\n    const stops = await gtfsService.getStops();\n    return stops.find(stop => stop.stopId === stopId) || null;\n  } catch (error) {\n    console.error(`Error getting details for stop ${stopId}:`, error);\n    return null;\n  }\n}\n\n/**\n * Merge real-time arrivals with scheduled departures\n * @param {Array} realTimeArrivals - Real-time arrival data\n * @param {Array} scheduledDepartures - Scheduled departure data\n * @returns {Array} Combined data with real-time updates where available\n */\nfunction mergeRealTimeAndSchedule(realTimeArrivals, scheduledDepartures) {\n  // Create a map of trips from real-time data\n  const realTimeMap = new Map();\n  realTimeArrivals.forEach(arrival => {\n    // Use tripId as the key\n    realTimeMap.set(arrival.tripId, arrival);\n  });\n  \n  // Enhance scheduled departures with real-time data\n  return scheduledDepartures.map(departure => {\n    const realTimeData = realTimeMap.get(departure.tripId);\n    \n    if (realTimeData) {\n      // Add real-time information\n      return {\n        ...departure,\n        realTime: true,\n        expectedArrival: realTimeData.expectedArrival,\n        delay: calculateDelay(departure.scheduledArrival, realTimeData.expectedArrival),\n        vehicleLocation: realTimeData.vehicleLocation || null,\n        distanceFromStop: realTimeData.distanceFromStop || null\n      };\n    } else {\n      // No real-time data available, use scheduled time\n      return {\n        ...departure,\n        realTime: false\n      };\n    }\n  });\n}\n\n/**\n * Calculate delay in minutes between scheduled and expected times\n * @param {string} scheduledTime - ISO datetime string\n * @param {string} expectedTime - ISO datetime string\n * @returns {number} Delay in minutes (positive = late, negative = early)\n */\nfunction calculateDelay(scheduledTime, expectedTime) {\n  if (!scheduledTime || !expectedTime) return 0;\n  \n  const scheduled = new Date(scheduledTime);\n  const expected = new Date(expectedTime);\n  \n  // Calculate difference in minutes\n  return Math.round((expected - scheduled) / (60 * 1000));\n}\n"],"mappings":"AAAA,OAAO,KAAKA,WAAW,MAAM,gBAAgB;AAC7C,OAAO,KAAKC,WAAW,MAAM,gBAAgB;;AAE7C;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeC,cAAcA,CAACC,WAAW,EAAE;EAChD,IAAI;IACF;IACA,MAAMC,gBAAgB,GAAG,MAAMJ,WAAW,CAACK,kBAAkB,CAACF,WAAW,CAAC;;IAE1E;IACA,MAAMG,mBAAmB,GAAG,MAAML,WAAW,CAACM,sBAAsB,CAACJ,WAAW,CAAC;;IAEjF;IACA,MAAMK,YAAY,GAAGC,wBAAwB,CAACL,gBAAgB,EAAEE,mBAAmB,CAAC;IAEpF,OAAO;MACLH,WAAW;MACXC,gBAAgB;MAChBE,mBAAmB;MACnBE;IACF,CAAC;EACH,CAAC,CAAC,OAAOE,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,2CAA2CP,WAAW,GAAG,EAAEO,KAAK,CAAC;IAC/E,MAAMA,KAAK;EACb;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeE,cAAcA,CAACC,MAAM,EAAE;EAC3C,IAAI;IACF,MAAMC,KAAK,GAAG,MAAMb,WAAW,CAACc,QAAQ,CAAC,CAAC;IAC1C,OAAOD,KAAK,CAACE,IAAI,CAACC,IAAI,IAAIA,IAAI,CAACJ,MAAM,KAAKA,MAAM,CAAC,IAAI,IAAI;EAC3D,CAAC,CAAC,OAAOH,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,kCAAkCG,MAAM,GAAG,EAAEH,KAAK,CAAC;IACjE,OAAO,IAAI;EACb;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAASD,wBAAwBA,CAACL,gBAAgB,EAAEE,mBAAmB,EAAE;EACvE;EACA,MAAMY,WAAW,GAAG,IAAIC,GAAG,CAAC,CAAC;EAC7Bf,gBAAgB,CAACgB,OAAO,CAACC,OAAO,IAAI;IAClC;IACAH,WAAW,CAACI,GAAG,CAACD,OAAO,CAACE,MAAM,EAAEF,OAAO,CAAC;EAC1C,CAAC,CAAC;;EAEF;EACA,OAAOf,mBAAmB,CAACkB,GAAG,CAACC,SAAS,IAAI;IAC1C,MAAMC,YAAY,GAAGR,WAAW,CAACS,GAAG,CAACF,SAAS,CAACF,MAAM,CAAC;IAEtD,IAAIG,YAAY,EAAE;MAChB;MACA,OAAO;QACL,GAAGD,SAAS;QACZG,QAAQ,EAAE,IAAI;QACdC,eAAe,EAAEH,YAAY,CAACG,eAAe;QAC7CC,KAAK,EAAEC,cAAc,CAACN,SAAS,CAACO,gBAAgB,EAAEN,YAAY,CAACG,eAAe,CAAC;QAC/EI,eAAe,EAAEP,YAAY,CAACO,eAAe,IAAI,IAAI;QACrDC,gBAAgB,EAAER,YAAY,CAACQ,gBAAgB,IAAI;MACrD,CAAC;IACH,CAAC,MAAM;MACL;MACA,OAAO;QACL,GAAGT,SAAS;QACZG,QAAQ,EAAE;MACZ,CAAC;IACH;EACF,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAASG,cAAcA,CAACI,aAAa,EAAEC,YAAY,EAAE;EACnD,IAAI,CAACD,aAAa,IAAI,CAACC,YAAY,EAAE,OAAO,CAAC;EAE7C,MAAMC,SAAS,GAAG,IAAIC,IAAI,CAACH,aAAa,CAAC;EACzC,MAAMI,QAAQ,GAAG,IAAID,IAAI,CAACF,YAAY,CAAC;;EAEvC;EACA,OAAOI,IAAI,CAACC,KAAK,CAAC,CAACF,QAAQ,GAAGF,SAAS,KAAK,EAAE,GAAG,IAAI,CAAC,CAAC;AACzD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}