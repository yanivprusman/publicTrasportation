{"ast":null,"code":"/**\n * Public Transportation API Service\n * Handles queries to Israel's public transportation SIRI-SM API\n */\n\nimport axios from 'axios';\n\n// Base URL for the proxy that handles SSH connection to the required host\nconst PROXY_URL = '/api/transport';\n\n/**\n * Get real-time arrivals for a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @returns {Promise<Object>} - The arrivals data\n */\nexport async function getStationArrivals(stationCode) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}`);\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Get arrivals for a specific line at a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @param {string|number} lineNumber - The line number (e.g., 60)\n * @returns {Promise<Object>} - The filtered arrivals data\n */\nexport async function getLineArrivalsAtStation(stationCode, lineNumber) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}&line=${lineNumber}`);\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching line arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Process the raw data from the SIRI-SM API\n * @param {Object} data - Raw API response\n * @returns {Array} - Processed arrival data\n */\nfunction processArrivalsData(data) {\n  try {\n    var _data$Siri, _data$Siri$ServiceDel, _data$Siri$ServiceDel2, _data$Siri$ServiceDel3;\n    // Extract the monitor visits from the response\n    const monitoredStopVisits = (data === null || data === void 0 ? void 0 : (_data$Siri = data.Siri) === null || _data$Siri === void 0 ? void 0 : (_data$Siri$ServiceDel = _data$Siri.ServiceDelivery) === null || _data$Siri$ServiceDel === void 0 ? void 0 : (_data$Siri$ServiceDel2 = _data$Siri$ServiceDel.StopMonitoringDelivery) === null || _data$Siri$ServiceDel2 === void 0 ? void 0 : (_data$Siri$ServiceDel3 = _data$Siri$ServiceDel2[0]) === null || _data$Siri$ServiceDel3 === void 0 ? void 0 : _data$Siri$ServiceDel3.MonitoredStopVisit) || [];\n\n    // Map the data to a more usable format\n    return monitoredStopVisits.map(visit => {\n      var _journey$FramedVehicl, _journey$OnwardCalls, _journey$OnwardCalls$;\n      const journey = visit.MonitoredVehicleJourney;\n      const call = journey.MonitoredCall;\n      return {\n        lineNumber: journey.PublishedLineName,\n        operatorRef: journey.OperatorRef,\n        destinationName: journey.DestinationName,\n        vehicleRef: journey.VehicleRef,\n        expectedArrival: (call === null || call === void 0 ? void 0 : call.ExpectedArrivalTime) || null,\n        aimedArrival: (call === null || call === void 0 ? void 0 : call.AimedArrivalTime) || null,\n        arrivalStatus: (call === null || call === void 0 ? void 0 : call.ArrivalStatus) || null,\n        distanceFromStop: (call === null || call === void 0 ? void 0 : call.DistanceFromStop) || null,\n        recordedAt: visit.RecordedAtTime,\n        stopPointRef: (call === null || call === void 0 ? void 0 : call.StopPointRef) || null,\n        tripId: ((_journey$FramedVehicl = journey.FramedVehicleJourneyRef) === null || _journey$FramedVehicl === void 0 ? void 0 : _journey$FramedVehicl.DatedVehicleJourneyRef) || null,\n        onwardCalls: ((_journey$OnwardCalls = journey.OnwardCalls) === null || _journey$OnwardCalls === void 0 ? void 0 : (_journey$OnwardCalls$ = _journey$OnwardCalls.OnwardCall) === null || _journey$OnwardCalls$ === void 0 ? void 0 : _journey$OnwardCalls$.map(call => ({\n          stopCode: call.StopPointRef,\n          order: call.Order,\n          expectedArrival: call.ExpectedArrivalTime,\n          status: call.ArrivalStatus\n        }))) || []\n      };\n    });\n  } catch (error) {\n    console.error('Error processing arrivals data:', error);\n    return [];\n  }\n}","map":{"version":3,"names":["axios","PROXY_URL","getStationArrivals","stationCode","response","get","processArrivalsData","data","error","console","getLineArrivalsAtStation","lineNumber","_data$Siri","_data$Siri$ServiceDel","_data$Siri$ServiceDel2","_data$Siri$ServiceDel3","monitoredStopVisits","Siri","ServiceDelivery","StopMonitoringDelivery","MonitoredStopVisit","map","visit","_journey$FramedVehicl","_journey$OnwardCalls","_journey$OnwardCalls$","journey","MonitoredVehicleJourney","call","MonitoredCall","PublishedLineName","operatorRef","OperatorRef","destinationName","DestinationName","vehicleRef","VehicleRef","expectedArrival","ExpectedArrivalTime","aimedArrival","AimedArrivalTime","arrivalStatus","ArrivalStatus","distanceFromStop","DistanceFromStop","recordedAt","RecordedAtTime","stopPointRef","StopPointRef","tripId","FramedVehicleJourneyRef","DatedVehicleJourneyRef","onwardCalls","OnwardCalls","OnwardCall","stopCode","order","Order","status"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/api-service.js"],"sourcesContent":["/**\n * Public Transportation API Service\n * Handles queries to Israel's public transportation SIRI-SM API\n */\n\nimport axios from 'axios';\n\n// Base URL for the proxy that handles SSH connection to the required host\nconst PROXY_URL = '/api/transport';\n\n/**\n * Get real-time arrivals for a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @returns {Promise<Object>} - The arrivals data\n */\nexport async function getStationArrivals(stationCode) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}`);\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Get arrivals for a specific line at a station\n * @param {string|number} stationCode - The station code (e.g., 26472)\n * @param {string|number} lineNumber - The line number (e.g., 60)\n * @returns {Promise<Object>} - The filtered arrivals data\n */\nexport async function getLineArrivalsAtStation(stationCode, lineNumber) {\n  try {\n    const response = await axios.get(`${PROXY_URL}?station=${stationCode}&line=${lineNumber}`);\n    return processArrivalsData(response.data);\n  } catch (error) {\n    console.error('Error fetching line arrivals:', error);\n    throw error;\n  }\n}\n\n/**\n * Process the raw data from the SIRI-SM API\n * @param {Object} data - Raw API response\n * @returns {Array} - Processed arrival data\n */\nfunction processArrivalsData(data) {\n  try {\n    // Extract the monitor visits from the response\n    const monitoredStopVisits = \n      data?.Siri?.ServiceDelivery?.StopMonitoringDelivery?.[0]?.MonitoredStopVisit || [];\n    \n    // Map the data to a more usable format\n    return monitoredStopVisits.map(visit => {\n      const journey = visit.MonitoredVehicleJourney;\n      const call = journey.MonitoredCall;\n      \n      return {\n        lineNumber: journey.PublishedLineName,\n        operatorRef: journey.OperatorRef,\n        destinationName: journey.DestinationName,\n        vehicleRef: journey.VehicleRef,\n        expectedArrival: call?.ExpectedArrivalTime || null,\n        aimedArrival: call?.AimedArrivalTime || null,\n        arrivalStatus: call?.ArrivalStatus || null,\n        distanceFromStop: call?.DistanceFromStop || null,\n        recordedAt: visit.RecordedAtTime,\n        stopPointRef: call?.StopPointRef || null,\n        tripId: journey.FramedVehicleJourneyRef?.DatedVehicleJourneyRef || null,\n        onwardCalls: journey.OnwardCalls?.OnwardCall?.map(call => ({\n          stopCode: call.StopPointRef,\n          order: call.Order,\n          expectedArrival: call.ExpectedArrivalTime,\n          status: call.ArrivalStatus\n        })) || []\n      };\n    });\n  } catch (error) {\n    console.error('Error processing arrivals data:', error);\n    return [];\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}