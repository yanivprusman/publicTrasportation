{"ast":null,"code":"import axios from 'axios';\n\n// Base URL for the GTFS API\nconst GTFS_BASE_URL = '/api/gtfs-api.php';\n\n// Mockup data for development until the backend is ready\nconst MOCK_STOPS = [{\n  stopId: '26472',\n  stopName: 'מסוף עמידר',\n  lat: 32.06948949599059,\n  lon: 34.83984033547383\n}, {\n  stopId: '20832',\n  stopName: 'גבעת שמואל',\n  lat: 32.06764959792775,\n  lon: 34.7867112130343\n}, {\n  stopId: '20834',\n  stopName: 'רמת גן',\n  lat: 32.08012,\n  lon: 34.81044\n}];\nconst MOCK_ROUTES = [{\n  routeId: '9141',\n  routeShortName: '60',\n  routeLongName: 'פתח תקוה - תל אביב'\n}, {\n  routeId: '9142',\n  routeShortName: '61',\n  routeLongName: 'בני ברק - תל אביב'\n}];\n\n/**\n * Check the status of GTFS data\n * @returns {Promise<Object>} Status information\n */\nexport async function checkGtfsStatus() {\n  try {\n    const response = await axios.get(`${GTFS_BASE_URL}?endpoint=status`);\n    return response.data;\n  } catch (error) {\n    console.error('Error checking GTFS status:', error);\n    return {\n      status: 'error',\n      error: error.message\n    };\n  }\n}\n\n/**\n * Update GTFS data - triggers a background update process\n * @returns {Promise<Object>} Update status\n */\nexport async function updateGtfsData() {\n  try {\n    const response = await axios.get(`${GTFS_BASE_URL}?endpoint=update`);\n    return response.data;\n  } catch (error) {\n    console.error('Error updating GTFS data:', error);\n    return {\n      status: 'error',\n      error: error.message\n    };\n  }\n}\n\n/**\n * Load stop information from GTFS data\n * @returns {Promise<Array>} List of stops\n */\nexport async function getStops() {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    if (status.status === 'ok') {\n      // Get stops from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=stops`);\n      return Array.isArray(response.data) ? response.data : MOCK_STOPS;\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      return MOCK_STOPS;\n    }\n  } catch (error) {\n    console.error('Error fetching GTFS stops:', error);\n    return MOCK_STOPS;\n  }\n}\n\n/**\n * Load route information from GTFS data\n * @returns {Promise<Array>} List of routes\n */\nexport async function getRoutes() {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    if (status.status === 'ok') {\n      // Get routes from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=routes`);\n      return Array.isArray(response.data) ? response.data : MOCK_ROUTES;\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      return MOCK_ROUTES;\n    }\n  } catch (error) {\n    console.error('Error fetching GTFS routes:', error);\n    return MOCK_ROUTES;\n  }\n}\n\n/**\n * Get scheduled departures for a stop\n * @param {string} stopId - The stop ID\n * @returns {Promise<Array>} List of scheduled departures\n */\nexport async function getScheduledDepartures(stopId) {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    if (status.status === 'ok') {\n      // Get departures from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=departures&stop=${stopId}`);\n      return Array.isArray(response.data) ? response.data : [];\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      // Return mock data for development\n      return [{\n        tripId: \"20925867\",\n        routeId: \"9141\",\n        lineNumber: \"60\",\n        destination: \"תל אביב\",\n        scheduledArrival: new Date(Date.now() + 600000).toISOString() // 10 minutes from now\n      }, {\n        tripId: \"20925868\",\n        routeId: \"9142\",\n        lineNumber: \"61\",\n        destination: \"בני ברק\",\n        scheduledArrival: new Date(Date.now() + 1200000).toISOString() // 20 minutes from now\n      }];\n    }\n  } catch (error) {\n    console.error(`Error fetching scheduled departures for stop ${stopId}:`, error);\n    // Return mock data as fallback\n    return [{\n      tripId: \"20925867\",\n      routeId: \"9141\",\n      lineNumber: \"60\",\n      destination: \"תל אביב\",\n      scheduledArrival: new Date(Date.now() + 600000).toISOString()\n    }, {\n      tripId: \"20925868\",\n      routeId: \"9142\",\n      lineNumber: \"61\",\n      destination: \"בני ברק\",\n      scheduledArrival: new Date(Date.now() + 1200000).toISOString()\n    }];\n  }\n}\n\n/**\n * Search for stops by name\n * @param {string} query - Search query\n * @returns {Promise<Array>} List of matching stops\n */\nexport async function searchStops(query) {\n  try {\n    const response = await axios.get(`${GTFS_BASE_URL}/stops/search?q=${encodeURIComponent(query)}`);\n    return response.data;\n  } catch (error) {\n    console.error('Error searching stops:', error);\n    return [];\n  }\n}\n\n/**\n * Get route shape (geometry)\n * @param {string} routeId - The route ID\n * @returns {Promise<Array>} List of coordinates forming the route shape\n */\nexport async function getRouteShape(routeId) {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    if (status.status === 'ok') {\n      // Get shape from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=shapes&route=${routeId}`);\n      return Array.isArray(response.data) ? response.data : [];\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      // Return mock shape data\n      if (routeId === '9141') {\n        return [[32.06948949599059, 34.83984033547383],\n        // Starting point\n        [32.06856, 34.82541],\n        // Point in between\n        [32.06764959792775, 34.7867112130343] // Destination\n        ];\n      }\n      return [];\n    }\n  } catch (error) {\n    console.error(`Error fetching shape for route ${routeId}:`, error);\n    return [];\n  }\n}","map":{"version":3,"names":["axios","GTFS_BASE_URL","MOCK_STOPS","stopId","stopName","lat","lon","MOCK_ROUTES","routeId","routeShortName","routeLongName","checkGtfsStatus","response","get","data","error","console","status","message","updateGtfsData","getStops","Array","isArray","warn","getRoutes","getScheduledDepartures","tripId","lineNumber","destination","scheduledArrival","Date","now","toISOString","searchStops","query","encodeURIComponent","getRouteShape"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/services/gtfs-service.js"],"sourcesContent":["import axios from 'axios';\n\n// Base URL for the GTFS API\nconst GTFS_BASE_URL = '/api/gtfs-api.php';\n\n// Mockup data for development until the backend is ready\nconst MOCK_STOPS = [\n  { stopId: '26472', stopName: 'מסוף עמידר', lat: 32.06948949599059, lon: 34.83984033547383 },\n  { stopId: '20832', stopName: 'גבעת שמואל', lat: 32.06764959792775, lon: 34.7867112130343 },\n  { stopId: '20834', stopName: 'רמת גן', lat: 32.08012, lon: 34.81044 }\n];\n\nconst MOCK_ROUTES = [\n  { routeId: '9141', routeShortName: '60', routeLongName: 'פתח תקוה - תל אביב' },\n  { routeId: '9142', routeShortName: '61', routeLongName: 'בני ברק - תל אביב' },\n];\n\n/**\n * Check the status of GTFS data\n * @returns {Promise<Object>} Status information\n */\nexport async function checkGtfsStatus() {\n  try {\n    const response = await axios.get(`${GTFS_BASE_URL}?endpoint=status`);\n    return response.data;\n  } catch (error) {\n    console.error('Error checking GTFS status:', error);\n    return { status: 'error', error: error.message };\n  }\n}\n\n/**\n * Update GTFS data - triggers a background update process\n * @returns {Promise<Object>} Update status\n */\nexport async function updateGtfsData() {\n  try {\n    const response = await axios.get(`${GTFS_BASE_URL}?endpoint=update`);\n    return response.data;\n  } catch (error) {\n    console.error('Error updating GTFS data:', error);\n    return { status: 'error', error: error.message };\n  }\n}\n\n/**\n * Load stop information from GTFS data\n * @returns {Promise<Array>} List of stops\n */\nexport async function getStops() {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    \n    if (status.status === 'ok') {\n      // Get stops from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=stops`);\n      return Array.isArray(response.data) ? response.data : MOCK_STOPS;\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      return MOCK_STOPS;\n    }\n  } catch (error) {\n    console.error('Error fetching GTFS stops:', error);\n    return MOCK_STOPS;\n  }\n}\n\n/**\n * Load route information from GTFS data\n * @returns {Promise<Array>} List of routes\n */\nexport async function getRoutes() {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    \n    if (status.status === 'ok') {\n      // Get routes from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=routes`);\n      return Array.isArray(response.data) ? response.data : MOCK_ROUTES;\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      return MOCK_ROUTES;\n    }\n  } catch (error) {\n    console.error('Error fetching GTFS routes:', error);\n    return MOCK_ROUTES;\n  }\n}\n\n/**\n * Get scheduled departures for a stop\n * @param {string} stopId - The stop ID\n * @returns {Promise<Array>} List of scheduled departures\n */\nexport async function getScheduledDepartures(stopId) {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    \n    if (status.status === 'ok') {\n      // Get departures from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=departures&stop=${stopId}`);\n      return Array.isArray(response.data) ? response.data : [];\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      // Return mock data for development\n      return [\n        {\n          tripId: \"20925867\",\n          routeId: \"9141\",\n          lineNumber: \"60\",\n          destination: \"תל אביב\",\n          scheduledArrival: new Date(Date.now() + 600000).toISOString(), // 10 minutes from now\n        },\n        {\n          tripId: \"20925868\",\n          routeId: \"9142\",\n          lineNumber: \"61\",\n          destination: \"בני ברק\",\n          scheduledArrival: new Date(Date.now() + 1200000).toISOString(), // 20 minutes from now\n        }\n      ];\n    }\n  } catch (error) {\n    console.error(`Error fetching scheduled departures for stop ${stopId}:`, error);\n    // Return mock data as fallback\n    return [\n      {\n        tripId: \"20925867\",\n        routeId: \"9141\",\n        lineNumber: \"60\",\n        destination: \"תל אביב\",\n        scheduledArrival: new Date(Date.now() + 600000).toISOString(),\n      },\n      {\n        tripId: \"20925868\",\n        routeId: \"9142\",\n        lineNumber: \"61\",\n        destination: \"בני ברק\",\n        scheduledArrival: new Date(Date.now() + 1200000).toISOString(),\n      }\n    ];\n  }\n}\n\n/**\n * Search for stops by name\n * @param {string} query - Search query\n * @returns {Promise<Array>} List of matching stops\n */\nexport async function searchStops(query) {\n  try {\n    const response = await axios.get(`${GTFS_BASE_URL}/stops/search?q=${encodeURIComponent(query)}`);\n    return response.data;\n  } catch (error) {\n    console.error('Error searching stops:', error);\n    return [];\n  }\n}\n\n/**\n * Get route shape (geometry)\n * @param {string} routeId - The route ID\n * @returns {Promise<Array>} List of coordinates forming the route shape\n */\nexport async function getRouteShape(routeId) {\n  try {\n    // First check if GTFS data is available\n    const status = await checkGtfsStatus();\n    \n    if (status.status === 'ok') {\n      // Get shape from API\n      const response = await axios.get(`${GTFS_BASE_URL}?endpoint=shapes&route=${routeId}`);\n      return Array.isArray(response.data) ? response.data : [];\n    } else {\n      console.warn('GTFS data not available, using mock data');\n      // Return mock shape data\n      if (routeId === '9141') {\n        return [\n          [32.06948949599059, 34.83984033547383],  // Starting point\n          [32.06856, 34.82541],                   // Point in between\n          [32.06764959792775, 34.7867112130343]    // Destination\n        ];\n      }\n      return [];\n    }\n  } catch (error) {\n    console.error(`Error fetching shape for route ${routeId}:`, error);\n    return [];\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}