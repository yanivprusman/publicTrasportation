{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport axios from 'axios';\nimport { fetchAddress, findRoute } from '../components/map/MapUtilities';\n\n/**\n * Hook that provides map-related handler functions\n */\nconst useMapHandlers = (position, destination, onDestinationSet, setMapCenter, mapCenter) => {\n  _s();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchError, setSearchError] = useState(null);\n  const [positionAddress, setPositionAddress] = useState('');\n  const [destinationAddress, setDestinationAddress] = useState('');\n\n  // Handle search input and query nominatim API\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) return;\n    try {\n      setSearchError(null);\n      const response = await axios.get(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(searchQuery)}&format=json`);\n      if (response.data.length > 0) {\n        const {\n          lat,\n          lon\n        } = response.data[0];\n        setMapCenter([parseFloat(lat), parseFloat(lon)]);\n      } else {\n        setSearchError('Location not found.');\n      }\n    } catch (error) {\n      setSearchError('Error fetching location. Please try again.');\n    }\n  };\n\n  // Set the starting point to the current map center\n  const handleSetStartPoint = () => {\n    fetchAddress(position[0], position[1], setPositionAddress);\n  };\n\n  // Set the destination to the current map center\n  const handleSetDestinationPoint = () => {\n    if (mapCenter && Array.isArray(mapCenter) && mapCenter.length === 2) {\n      console.log(\"Setting destination to map center:\", mapCenter);\n      onDestinationSet(mapCenter); // Fix: Use mapCenter instead of position\n      fetchAddress(mapCenter[0], mapCenter[1], setDestinationAddress);\n    } else {\n      console.error(\"Invalid map center for destination:\", mapCenter);\n    }\n  };\n\n  // Handle keyboard events for search\n  const handleKeyPress = e => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  // Find a route between position and destination\n  const handleFindRoute = async () => {\n    console.log(\"Find route called with: position=\", position, \"destination=\", destination);\n    if (!destination || !destination[0] || !destination[1]) {\n      console.error(\"Missing or invalid destination:\", destination);\n      setSearchError('Please set a destination first.');\n      return null;\n    }\n    const MAX_RETRIES = 3;\n    let attempts = 0;\n    while (attempts < MAX_RETRIES) {\n      try {\n        setSearchError(null);\n        console.log(\"Calling findRoute with position:\", position, \"destination:\", destination);\n        const routeData = await findRoute(position, destination);\n        if (routeData) {\n          console.log(\"Route data received:\", routeData.length, \"points\");\n          return routeData;\n        } else {\n          setSearchError('No route found. Please try again with different locations.');\n          return null;\n        }\n      } catch (error) {\n        console.error(\"Error in findRoute:\", error);\n        attempts++;\n        if (attempts >= MAX_RETRIES) {\n          setSearchError('Error fetching route. Please try again.');\n        }\n      }\n    }\n    return null;\n  };\n  return {\n    searchQuery,\n    setSearchQuery,\n    searchError,\n    positionAddress,\n    destinationAddress,\n    setPositionAddress,\n    setDestinationAddress,\n    handleSearch,\n    handleSetStartPoint,\n    handleSetDestinationPoint,\n    handleKeyPress,\n    handleFindRoute\n  };\n};\n_s(useMapHandlers, \"SCu2p6AoFj+L6JkmJKJRMr561NM=\");\nexport default useMapHandlers;","map":{"version":3,"names":["useState","axios","fetchAddress","findRoute","useMapHandlers","position","destination","onDestinationSet","setMapCenter","mapCenter","_s","searchQuery","setSearchQuery","searchError","setSearchError","positionAddress","setPositionAddress","destinationAddress","setDestinationAddress","handleSearch","trim","response","get","encodeURIComponent","data","length","lat","lon","parseFloat","error","handleSetStartPoint","handleSetDestinationPoint","Array","isArray","console","log","handleKeyPress","e","key","handleFindRoute","MAX_RETRIES","attempts","routeData"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/hooks/useMapHandlers.js"],"sourcesContent":["import { useState } from 'react';\nimport axios from 'axios';\nimport { fetchAddress, findRoute } from '../components/map/MapUtilities';\n\n/**\n * Hook that provides map-related handler functions\n */\nconst useMapHandlers = (position, destination, onDestinationSet, setMapCenter, mapCenter) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchError, setSearchError] = useState(null);\n  const [positionAddress, setPositionAddress] = useState('');\n  const [destinationAddress, setDestinationAddress] = useState('');\n  \n  // Handle search input and query nominatim API\n  const handleSearch = async () => {\n    if (!searchQuery.trim()) return;\n\n    try {\n      setSearchError(null);\n      const response = await axios.get(\n        `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(searchQuery)}&format=json`\n      );\n      if (response.data.length > 0) {\n        const { lat, lon } = response.data[0];\n        setMapCenter([parseFloat(lat), parseFloat(lon)]);\n      } else {\n        setSearchError('Location not found.');\n      }\n    } catch (error) {\n      setSearchError('Error fetching location. Please try again.');\n    }\n  };\n\n  // Set the starting point to the current map center\n  const handleSetStartPoint = () => {\n    fetchAddress(position[0], position[1], setPositionAddress);\n  };\n\n  // Set the destination to the current map center\n  const handleSetDestinationPoint = () => {\n    if (mapCenter && Array.isArray(mapCenter) && mapCenter.length === 2) {\n      console.log(\"Setting destination to map center:\", mapCenter);\n      onDestinationSet(mapCenter); // Fix: Use mapCenter instead of position\n      fetchAddress(mapCenter[0], mapCenter[1], setDestinationAddress);\n    } else {\n      console.error(\"Invalid map center for destination:\", mapCenter);\n    }\n  };\n\n  // Handle keyboard events for search\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleSearch();\n    }\n  };\n\n  // Find a route between position and destination\n  const handleFindRoute = async () => {\n    console.log(\"Find route called with: position=\", position, \"destination=\", destination);\n    \n    if (!destination || !destination[0] || !destination[1]) {\n      console.error(\"Missing or invalid destination:\", destination);\n      setSearchError('Please set a destination first.');\n      return null;\n    }\n\n    const MAX_RETRIES = 3;\n    let attempts = 0;\n\n    while (attempts < MAX_RETRIES) {\n      try {\n        setSearchError(null);\n        console.log(\"Calling findRoute with position:\", position, \"destination:\", destination);\n        const routeData = await findRoute(position, destination);\n        \n        if (routeData) {\n          console.log(\"Route data received:\", routeData.length, \"points\");\n          return routeData;\n        } else {\n          setSearchError('No route found. Please try again with different locations.');\n          return null;\n        }\n      } catch (error) {\n        console.error(\"Error in findRoute:\", error);\n        attempts++;\n        if (attempts >= MAX_RETRIES) {\n          setSearchError('Error fetching route. Please try again.');\n        }\n      }\n    }\n    return null;\n  };\n\n  return {\n    searchQuery,\n    setSearchQuery,\n    searchError,\n    positionAddress,\n    destinationAddress,\n    setPositionAddress,\n    setDestinationAddress,\n    handleSearch,\n    handleSetStartPoint,\n    handleSetDestinationPoint,\n    handleKeyPress,\n    handleFindRoute\n  };\n};\n\nexport default useMapHandlers;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}