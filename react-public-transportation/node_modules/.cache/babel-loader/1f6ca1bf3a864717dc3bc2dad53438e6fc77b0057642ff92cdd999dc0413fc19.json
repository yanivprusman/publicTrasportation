{"ast":null,"code":"import axios from 'axios';\n\n/**\n * Get real-time arrivals for a station\n * @param {string} stationCode - The station code\n * @param {string} detailLevel - The level of detail ('normal' or 'calls')\n * @returns {Promise<Object>} - The arrivals data\n */\nexport const fetchStationArrivals = async (stationCode, detailLevel = 'calls') => {\n  try {\n    const response = await axios.get(`/transport.php?station=${stationCode}&detail=${detailLevel}`);\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw new Error(`Failed to fetch arrivals: ${error.message}`);\n  }\n};\n\n/**\n * Extract vehicle markers from SIRI data\n * @param {Object} siriData - The SIRI data from the API\n * @returns {Array} - Array of vehicle marker objects\n */\nexport const extractVehicleMarkers = siriData => {\n  var _siriData$Siri, _siriData$Siri$Servic, _siriData$Siri$Servic2, _siriData$Siri$Servic3;\n  if (!(siriData !== null && siriData !== void 0 && (_siriData$Siri = siriData.Siri) !== null && _siriData$Siri !== void 0 && (_siriData$Siri$Servic = _siriData$Siri.ServiceDelivery) !== null && _siriData$Siri$Servic !== void 0 && (_siriData$Siri$Servic2 = _siriData$Siri$Servic.StopMonitoringDelivery) !== null && _siriData$Siri$Servic2 !== void 0 && (_siriData$Siri$Servic3 = _siriData$Siri$Servic2[0]) !== null && _siriData$Siri$Servic3 !== void 0 && _siriData$Siri$Servic3.MonitoredStopVisit)) {\n    return [];\n  }\n  const monitoredStopVisits = siriData.Siri.ServiceDelivery.StopMonitoringDelivery[0].MonitoredStopVisit;\n  return monitoredStopVisits.map(visit => {\n    const journey = visit.MonitoredVehicleJourney || {};\n    const vehicleLocation = journey.VehicleLocation || {};\n    if (vehicleLocation.Latitude && vehicleLocation.Longitude) {\n      var _journey$MonitoredCal, _journey$MonitoredCal2;\n      return {\n        position: [vehicleLocation.Latitude, vehicleLocation.Longitude],\n        vehicleRef: journey.VehicleRef,\n        lineNumber: journey.PublishedLineName,\n        expectedArrival: (_journey$MonitoredCal = journey.MonitoredCall) === null || _journey$MonitoredCal === void 0 ? void 0 : _journey$MonitoredCal.ExpectedArrivalTime,\n        distanceFromStop: (_journey$MonitoredCal2 = journey.MonitoredCall) === null || _journey$MonitoredCal2 === void 0 ? void 0 : _journey$MonitoredCal2.DistanceFromStop\n      };\n    }\n    return null;\n  }).filter(Boolean);\n};\n\n/**\n * Fetch the route shape for a given line number\n * @param {string} lineNumber - The line number\n * @returns {Promise<Object>} - The route shape data\n */\nexport const fetchLineShape = async lineNumber => {\n  try {\n    console.log(`Fetching line shape for line ${lineNumber}`);\n\n    // Order is important - try the most reliable endpoints first\n    const urls = [`/simple-shape-api.php?line=${lineNumber}`,\n    // Try direct path first\n    `/api/simple-shape-api.php?line=${lineNumber}`,\n    // Then try in api folder\n    `/api/test-api-local.php?line=${lineNumber}`, `/api/gtfs-api.php?action=getLineShape&line=${lineNumber}`,\n    // This one is currently failing\n    `/gtfs-api.php?action=getLineShape&line=${lineNumber}`];\n    console.log(\"Will try endpoints in this order:\", urls);\n    for (const url of urls) {\n      try {\n        console.log(`Attempting to fetch from: ${url}`);\n        const response = await fetch(url, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json',\n            'Cache-Control': 'no-cache'\n          }\n        });\n        if (!response.ok) {\n          console.warn(`URL ${url} returned status ${response.status}`);\n          continue;\n        }\n        const data = await response.json();\n        console.log(`Success with ${url}:`, data);\n        return data;\n      } catch (e) {\n        console.warn(`Error with ${url}:`, e.message);\n      }\n    }\n    throw new Error('All API endpoints failed');\n  } catch (error) {\n    console.error('Error fetching line shape:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["axios","fetchStationArrivals","stationCode","detailLevel","response","get","data","error","console","Error","message","extractVehicleMarkers","siriData","_siriData$Siri","_siriData$Siri$Servic","_siriData$Siri$Servic2","_siriData$Siri$Servic3","Siri","ServiceDelivery","StopMonitoringDelivery","MonitoredStopVisit","monitoredStopVisits","map","visit","journey","MonitoredVehicleJourney","vehicleLocation","VehicleLocation","Latitude","Longitude","_journey$MonitoredCal","_journey$MonitoredCal2","position","vehicleRef","VehicleRef","lineNumber","PublishedLineName","expectedArrival","MonitoredCall","ExpectedArrivalTime","distanceFromStop","DistanceFromStop","filter","Boolean","fetchLineShape","log","urls","url","fetch","method","headers","ok","warn","status","json","e"],"sources":["/home/yaniv/101_coding/publicTransportation/react/public-transportation/src/services/transport-api.js"],"sourcesContent":["import axios from 'axios';\n\n/**\n * Get real-time arrivals for a station\n * @param {string} stationCode - The station code\n * @param {string} detailLevel - The level of detail ('normal' or 'calls')\n * @returns {Promise<Object>} - The arrivals data\n */\nexport const fetchStationArrivals = async (stationCode, detailLevel = 'calls') => {\n  try {\n    const response = await axios.get(`/transport.php?station=${stationCode}&detail=${detailLevel}`);\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching station arrivals:', error);\n    throw new Error(`Failed to fetch arrivals: ${error.message}`);\n  }\n};\n\n/**\n * Extract vehicle markers from SIRI data\n * @param {Object} siriData - The SIRI data from the API\n * @returns {Array} - Array of vehicle marker objects\n */\nexport const extractVehicleMarkers = (siriData) => {\n  if (!siriData?.Siri?.ServiceDelivery?.StopMonitoringDelivery?.[0]?.MonitoredStopVisit) {\n    return [];\n  }\n\n  const monitoredStopVisits = siriData.Siri.ServiceDelivery.StopMonitoringDelivery[0].MonitoredStopVisit;\n  \n  return monitoredStopVisits.map(visit => {\n    const journey = visit.MonitoredVehicleJourney || {};\n    const vehicleLocation = journey.VehicleLocation || {};\n    \n    if (vehicleLocation.Latitude && vehicleLocation.Longitude) {\n      return {\n        position: [vehicleLocation.Latitude, vehicleLocation.Longitude],\n        vehicleRef: journey.VehicleRef,\n        lineNumber: journey.PublishedLineName,\n        expectedArrival: journey.MonitoredCall?.ExpectedArrivalTime,\n        distanceFromStop: journey.MonitoredCall?.DistanceFromStop\n      };\n    }\n    return null;\n  }).filter(Boolean);\n};\n\n/**\n * Fetch the route shape for a given line number\n * @param {string} lineNumber - The line number\n * @returns {Promise<Object>} - The route shape data\n */\nexport const fetchLineShape = async (lineNumber) => {\n  try {\n    console.log(`Fetching line shape for line ${lineNumber}`);\n    \n    // Order is important - try the most reliable endpoints first\n    const urls = [\n      `/simple-shape-api.php?line=${lineNumber}`, // Try direct path first\n      `/api/simple-shape-api.php?line=${lineNumber}`, // Then try in api folder\n      `/api/test-api-local.php?line=${lineNumber}`,\n      `/api/gtfs-api.php?action=getLineShape&line=${lineNumber}`, // This one is currently failing\n      `/gtfs-api.php?action=getLineShape&line=${lineNumber}`\n    ];\n    \n    console.log(\"Will try endpoints in this order:\", urls);\n    \n    for (const url of urls) {\n      try {\n        console.log(`Attempting to fetch from: ${url}`);\n        const response = await fetch(url, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json',\n            'Cache-Control': 'no-cache'\n          }\n        });\n        \n        if (!response.ok) {\n          console.warn(`URL ${url} returned status ${response.status}`);\n          continue;\n        }\n        \n        const data = await response.json();\n        console.log(`Success with ${url}:`, data);\n        return data;\n      } catch (e) {\n        console.warn(`Error with ${url}:`, e.message);\n      }\n    }\n    \n    throw new Error('All API endpoints failed');\n  } catch (error) {\n    console.error('Error fetching line shape:', error);\n    throw error;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}